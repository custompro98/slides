<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Learn RSpec 04</title>
        <meta name="description" content="This presentation is generated by vim-reveal and reveal.js.">
        <meta name="author" content="author">
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <link rel="stylesheet" href="../../css/reveal.css">
        <link rel="stylesheet" href="../../css/theme/solarized.css" id="theme">
        <link rel="stylesheet" href="../../lib/css/zenburn.css">
        <!-- If the query includes 'print-pdf', use the PDF print sheet -->
        <script>
            document.write( '<link rel="stylesheet" href="../../css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
        </script>
        <!--[if lt IE 9]>
        <script src="../../lib/js/html5shiv.js"></script>
        <![endif]-->
    </head>

    <body>
        <div class="reveal">
            <div class="slides">

<section>
<section data-markdown >
<script type="text/template">
# Request specs

</script>
</section>
<section data-markdown >
<script type="text/template">
## What's different from the unit specs we wrote?

</script>
</section>
<section data-markdown >
<script type="text/template">
A request spec is used to test the endpoints in a Rails API

Note:
This API has a simple model structure, being only users, bookmakrs, and tags
This should be small enough to get us going but large enough to allow for any exploration on our own
</script>
</section>
<section data-markdown >
<script type="text/template">
Let's start by building one for /bookmarks

</script>
</section>
</section>
<section>
<section data-markdown >
<script type="text/template">
## So how do we set it up?

</script>
</section>
<section data-markdown >
<script type="text/template">
```ruby
# spec/requests/get_bookmarks_spec.rb
require 'rails_helper'

describe 'Bookmarks', type: :request do
  describe 'GET /bookmarks' do
    before { get v1_bookmarks_path }

    it 'returns an empty array' do
      expect(json[:bookmarks]).to be_empty
    end
  end
end
```

</script>
</section>
<section data-markdown >
<script type="text/template">
## Why did it say `expected nil to respond to empty?`?

</script>
</section>
<section data-markdown >
<script type="text/template">
Because the correct headers weren't being sent

</script>
</section>
<section data-markdown >
<script type="text/template">
Let's handwave over this for now (unless anyone has any objections)

Note:
This application has user authentication, only returning bookmarks that belong to the user
We need to create a user to be logged in, so we'll use a helper that's already written for us

</script>
</section>
<section data-markdown >
<script type="text/template">
```ruby
require 'rails_helper'

describe 'Bookmarks', type: :request do
  describe 'GET /bookmarks' do
    let(:owner) { create(:user) }

    before { get v1_bookmarks_path, headers: headers(owner) }

    it 'returns an empty array' do
      expect(json[:bookmarks]).to be_empty
    end
  end
end
```

</script>
</section>
</section>
<section>
<section data-markdown >
<script type="text/template">
## ...now the user factory isn't generated?

</script>
</section>
<section data-markdown >
<script type="text/template">
```ruby
# spec/factories/users.rb
FactoryBot.define do
  factory :user do
    first_name 'Tester'
    sequence(:last_name).to_s
    sequence(:email) { |n| "#{n}@example.com" }
    password 'password'
  end
end
```

Note:
We only want to populate fields that are marked as required in the database, that way we only create as much data as we need
We use sequences to generate random data, every time we create a user the sequence will increase by 1.  So that means evey user will have a unique last name and email address in this case

</script>
</section>
</section>
<section>
<section data-markdown >
<script type="text/template">
## Our test passed! That was a lot of set up...

</script>
</section>
<section data-markdown >
<script type="text/template">
Requet specs often take longer to set up than unit tests, which is why there should be fewer than your request specs

</script>
</section>
<section data-markdown >
<script type="text/template">
![pyramid](images/test_pyramid.png)

Note:
The testing pyramid shows that we should have mostly unit tests as our foundation, hitting every happy and sad path
Next we should have our service (or integration) tests, these hit every happy path and maybe a few sad paths
And at the top we have our UI (or acceptance) tests, these hit the critical happy paths in our application

The speed decreases while the cost of the test in terms of computational power increases
</script>
</section>
</section>
            </div>
        </div>
        <script src="../../lib/js/head.min.js"></script>
        <script src="../../js/reveal.js"></script>
        <script>
            Reveal.initialize({
                controls: true,
                progress: true,
                history: false,
                keyboard: true,
                touch: true,
                center: true,
                loop: false,
                rtl: false,
                mouseWheel: false,
                margin: 0.1,
                minScale: 0.2,
                maxScale: 1.0,
                autoSlide: 0,
                width: 960,
                height: 900,
                theme: 'solarized',
                transition: 'default',
                transitionSpeed: 'default',
                backgroundTransition: 'default',
                // Optional libraries used to extend on reveal.js
                dependencies: [
                    { src: '../../lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    { src: '../../plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: '../../plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: '../../plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                    { src: '../../plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
                    { src: '../../plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },
                    { src: '../../plugin/math/math.js', async: true }
                ]
            });
        </script>
    </body>
</html>
